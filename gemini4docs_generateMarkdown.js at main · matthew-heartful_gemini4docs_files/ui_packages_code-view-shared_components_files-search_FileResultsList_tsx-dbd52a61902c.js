"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_code-view-shared_components_files-search_FileResultsList_tsx"],{47142:(e,r,t)=>{t.d(r,{CD:()=>o,DU:()=>n,Gs:()=>i,m7:()=>l});var a=-1/0,n=1/0;function s(e,r,t,n){for(var s=e.length,i=r.length,l=e.toLowerCase(),o=r.toLowerCase(),c=function(e){for(var r=e.length,t=Array(r),a="/",n=0;n<r;n++){var s,i=e[n];"/"===a?t[n]=.9:"-"===a||"_"===a||" "===a?t[n]=.8:"."===a?t[n]=.6:(s=a).toLowerCase()===s&&i.toUpperCase()===i?t[n]=.7:t[n]=0,a=i}return t}(r,c),u=0;u<s;u++){t[u]=Array(i),n[u]=Array(i);for(var d=a,f=u===s-1?-.005:-.01,h=0;h<i;h++)if(l[u]===o[h]){var m=a;u?h&&(m=Math.max(n[u-1][h-1]+c[h],t[u-1][h-1]+1)):m=-.005*h+c[h],t[u][h]=m,n[u][h]=d=Math.max(m,d+f)}else t[u][h]=a,n[u][h]=d+=f}}function i(e,r){var t=e.length,i=r.length;if(!t||!i)return a;if(t===i)return n;if(i>1024)return a;var l=Array(t),o=Array(t);return s(e,r,l,o),o[t-1][i-1]}function l(e,r){var t=e.length,n=r.length,i=Array(t);if(!t||!n)return i;if(t===n){for(var l=0;l<t;l++)i[l]=l;return i}if(n>1024)return i;var o=Array(t),c=Array(t);s(e,r,o,c);for(var u=!1,l=t-1,d=n-1;l>=0;l--)for(;d>=0;d--)if(o[l][d]!==a&&(u||o[l][d]===c[l][d])){u=l&&d&&c[l][d]===o[l-1][d-1]+1,i[l]=d--;break}return i}function o(e,r){e=e.toLowerCase(),r=r.toLowerCase();for(var t=e.length,a=0,n=0;a<t;a+=1)if(0===(n=r.indexOf(e[a],n)+1))return!1;return!0}},28114:(e,r,t)=>{t.d(r,{V:()=>WebWorker});let WebWorker=class WebWorker{set onmessage(e){this.worker.onmessage=e}postMessage(e){this.worker.postMessage(e)}terminate(){this.worker.terminate()}constructor(e,r){try{this.worker=new Worker(e)}catch(e){console.warn("Web workers are not available. Please enable web workers to benefit from the improved performance."),this.worker=new MainThreadWorker(r)}}};let MainThreadWorker=class MainThreadWorker{async postMessage(e){if(this.terminated)return;let r={data:this.job({data:e})};this.onmessage?.(r)}terminate(){this.terminated=!0}constructor(e){this.job=e,this.terminated=!1}}},88947:(e,r,t)=>{t.r(r),t.d(r,{FileResultRow:()=>$,default:()=>M});var a=t(85893),n=t(211),s=t(86525),i=t(23180),l=t(79842),o=t(52674),c=t(15429),u=t(22326),d=t(77461),f=t(51952),h=t(85193),m=t(48542),x=t(13275),p=t(85529),g=t(17840),v=t(42483),w=t(51461),y=t(14786),b=t(73290),C=t(2708),j=t(74121),R=t(98833),E=t(97011),k=t(47142),S=t(67294),L=t(28114),A=t(15205);let F=(0,A.Z)(k.Gs);function N({data:e}){let{query:r,baseList:t,startTime:a}=e,n=r.replaceAll("\\",""),s=t.filter(e=>""===n||(0,k.CD)(n,e)&&F(n,e)>0).sort((e,r)=>F(n,r)-F(n,e));return{query:r,list:s,baseCount:t.length,startTime:a}}var I=t(21573),Z=t(87623);async function T(e){let r=await (0,Z.v)(e);return r.ok?await r.json():void 0}let _=new Map,D=(0,A.Z)(T,{cache:_});function M({onRenderRow:e,onItemSelected:r,searchBoxRef:t,sx:d={},...p}){let{query:j,setQuery:R}=(0,n.aM)(),E=(0,o.H)(),k=S.useRef(null),A=t??k,[F,Z]=S.useState(j.length>0),[T,_]=S.useState(!!j),{list:M,directories:$,loading:H,error:O}=function(e){let r=(0,o.H)(),{refInfo:t}=(0,s.Br)(),[a,n]=(0,S.useState)({list:[],directories:[],loading:!0}),i=(0,u.a_)({repo:r,commitOid:t.currentOid,includeDirectories:!0});return(0,S.useEffect)(()=>{let r=!1,t=async()=>{n({list:[],directories:[],loading:!0});let e=await D(i);if(r)return;let t=e?.paths||[],a=e?.directories||[],s=t.concat(a).sort();n({list:s,directories:a,error:!e})};return e&&t(),function(){r=!0}},[i,e]),a}(F),{path:q}=(0,s.Br)(),{findFileWorkerPath:B}=(0,s.Ou)(),{getUrl:V}=(0,l.B)(),{queryText:z,queryLine:P}=function(e){e=e.replaceAll(" ","");let r=e.indexOf(":");return r>=0?{queryText:e.substring(0,r),queryLine:parseInt(e.substring(r+1),10)}:{queryText:e,queryLine:void 0}}(j),{matches:U,clearMatches:K}=function(e,r,t,a){let[n,s]=S.useState(),l=S.useRef(""),o=S.useRef(),{sendStats:c}=(0,i.a)(),u=S.useRef(!1),d=S.useCallback(()=>{let e=new L.V(t,N);e.onmessage=({data:e})=>{u.current=!1,s(e.list),l.current=e.query,e.startTime&&c("repository.find-file",{"find-file-base-count":e.baseCount,"find-file-results-count":e.list.length,"find-file-duration-ms":performance.now()-e.startTime})},o.current=e},[c,t]);return S.useEffect(()=>{if(a)return d(),function(){o.current?.terminate()}},[d,a]),S.useEffect(()=>{if(e.length&&r){u.current&&(o.current?.terminate(),d());let t=l.current&&r.startsWith(l.current);u.current=!0,o.current?.postMessage({baseList:t&&n||e,query:r,startTime:performance.now()})}},[e,r,d]),{matches:n,clearMatches:()=>s(void 0)}}(M,z,B,F),{sendRepoClickEvent:Y}=(0,i.a)(),Q=(0,h.s)(),[X,J]=S.useState(0),[ee,er]=S.useState((0,I.$)()),et=S.useRef(null),ea=S.useRef(null),en="file-results-list",{sendRepoKeyDownEvent:es}=(0,i.a)(),{screenSize:ei}=(0,f.eI)(),el=p.useOverlay||ei>=f._G.large,eo=S.useCallback(()=>{Y("FILE_TREE.SEARCH_RESULT_CLICK"),r?.(),_(!1)},[Y,r]),{containerRef:ec}=(0,g.v)({bindKeys:m.Qw.ArrowVertical|m.Qw.HomeAndEnd,focusInStrategy:"previous"},[H,O]);S.useEffect(()=>{j||_(!1)},[j]),S.useEffect(()=>{document.activeElement!==A.current&&el&&_(!1)},[q,A,el]);let eu=U?.slice(0,40)||[],ed=U&&U.length>eu.length,ef=(0,a.jsx)(v.Z,{sx:{maxHeight:el?"60vh":"100% !important",overflowY:"auto",scrollbarGutter:"stable",maxWidth:"100vw","@media (max-width: 768px)":{ml:3,mr:2}},children:O?(0,a.jsx)(w.Z,{variant:"danger",sx:{m:3},children:"Failed to search"}):(0,a.jsxs)(y.S,{ref:ec,sx:{overflow:"auto",p:el?2:3,width:"100%",pr:el?3:0,pt:el?3:"2px !important"},role:"listbox",children:[!H&&eu.map((r,t)=>{let n=$.includes(r);return(0,a.jsx)(G,{active:r===q,index:t,focused:ee&&X===t,match:r,onRender:e,query:z,onClick:eo,isDirectory:n,to:V({path:r,action:n?"tree":"blob",hash:P?`L${P}`:""}),useOverlay:el,listRef:ec},r)}),(0,a.jsxs)(v.Z,{sx:{m:3,textAlign:"center"},children:[(0,a.jsx)(W,{loading:H||!U,visibleResultCount:eu.length,truncated:!!ed}),ed&&(0,a.jsxs)(a.Fragment,{children:["\xa0",(0,a.jsx)(b.Z,{id:"see-all-results-link",className:"focus-visible",ref:et,href:(0,u.mY)({owner:E.ownerLogin,repo:E.name,searchTerm:`path:${z}`}),sx:ee&&X===eu.length?{outline:"2px solid var(--focus-outlineColor, var(--color-accent-fg))",outlineOffset:"-2px",boxShadow:"none"}:{},children:"See all results"})]})]})]})});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{ref:ea,sx:{mx:2,ml:3,...d},children:(0,a.jsx)(I.f,{ariaActiveDescendant:(!el&&j||el&&T)&&ee&&X>-1?ed&&X===eu.length?"see-all-results-link":`file-result-${X}`:void 0,ariaExpanded:el?T:void 0,ariaHasPopup:el,ariaControls:el?en:void 0,ref:A,query:j,onKeyDown:e=>{let{key:r,shiftKey:t,metaKey:a,altKey:n,ctrlKey:s}=e;if(!t&&!a&&!n){if("Escape"===r)j?(es("FILE_TREE.CANCEL_SEARCH"),R(""),K()):document.activeElement&&document.activeElement.blur();else if(!j)return;else if("Enter"===r)ed&&X===eu.length?Q((0,u.mY)({owner:E.ownerLogin,repo:E.name,searchTerm:`path:${z}`})):eu[X]&&(Q(V({path:eu[X],action:"blob",hash:P?`L${P}`:""})),_(!1));else if("ArrowDown"===r||s&&"n"===r){if(ed&&X>=eu.length-1){if(J(eu.length),et.current&&ec.current){let e=(0,c.M)(ec.current);(0,x.z)(et.current,e,{behavior:"instant"})}}else J(Math.min(X+1,eu.length-1));e.preventDefault();return}else if("ArrowUp"===r||s&&"p"===r){J(Math.max(X-1,0)),e.preventDefault();return}}},onPreload:()=>Z(!0),onSearch:e=>{R(e),e?_(!0):(K(),_(!1)),J(0)},onBlur:e=>{ec.current?.contains(e.relatedTarget)||(_(!1),er(!1))},onFocus:()=>{j&&_(!0),er(!0)},sx:{minWidth:"160px"}})}),el&&(0,a.jsx)(C.w,{anchorRef:ea,open:el&&T,renderAnchor:null,onClose:()=>{_(!1)},focusZoneSettings:{disabled:!0},focusTrapSettings:{disabled:!0},width:"xlarge",align:"end",overlayProps:{id:en,role:"dialog"},children:ef}),!el&&j&&ef]})}function W({visibleResultCount:e,truncated:r,loading:t}){return(0,a.jsx)("span",{role:"status",className:t||r||0===e?void 0:"sr-only","aria-label":t?"Loading":void 0,children:t?(0,a.jsx)(j.Z,{size:"large"}):0===e?"No matches found":r?`First ${e} files shown.`:`Showing ${e} files.`},"results-count-status")}let $=({active:e,focused:r,index:t,match:n,query:s,to:i,isDirectory:l,onClick:o,onRender:u,useOverlay:f,listRef:h})=>{let m=(0,k.m7)(s,n);u?.();let p=S.useRef(null),g=l?H:O;S.useEffect(()=>{if(r&&p.current&&h?.current){let e=(0,c.M)(h.current);(0,x.z)(p.current,e,{behavior:"instant"})}},[r,h]);let w={};return r&&(w={outline:"none",border:"2 solid",boxShadow:"0 0 0 2px #0969da"}),(0,a.jsx)(y.S.Item,{id:`file-result-${t}`,ref:p,as:d.r,onSelect:o,to:i,active:e,sx:{fontWeight:"normal",":hover":{textDecoration:"none"},mx:"2px",width:"calc(100% - 4px)",...w},role:"option","data-focus-visible-added":r||void 0,tabIndex:f?-1:0,children:(0,a.jsxs)(v.Z,{sx:{display:"flex"},children:[(0,a.jsx)(v.Z,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",flexGrow:1},children:(0,a.jsx)(q,{text:n,positionsList:m,sx:{color:"fg.muted"},LeadingIcon:g})}),r&&(0,a.jsx)(v.Z,{sx:{pl:1,whiteSpace:"nowrap",color:"fg.muted"},children:`Go to ${l?"folder":"file"}`})]})},n)},H=()=>(0,a.jsx)(R.Z,{"aria-label":"Directory",icon:p.FileDirectoryFillIcon,sx:{color:"var(--treeViewItem-leadingVisual-iconColor-rest, var(--color-icon-directory))",mr:2},size:"small"}),O=()=>(0,a.jsx)(R.Z,{"aria-label":"File",icon:p.FileIcon,sx:{color:"fg.muted",mr:2},size:"small"}),G=S.memo($);function q({text:e,positionsList:r,sx:t,LeadingIcon:n}){let s=[],i=0;for(let t of r){if(Number(t)!==t||t<i||t>e.length)continue;let r=e.slice(i,t);r&&s.push(B(r)),i=t+1,s.push((0,a.jsx)(E.Z,{as:"mark",sx:{fontWeight:"bold",background:"none",color:"fg.default"},children:e[t]},t))}return s.push(B(e.slice(i))),(0,a.jsx)(v.Z,{sx:t,children:(0,a.jsxs)(a.Fragment,{children:[n&&(0,a.jsx)(n,{}),s]})})}function B(e){return e.replaceAll("/","/\u200B")}try{M.displayName||(M.displayName="FileResultsList")}catch{}try{W.displayName||(W.displayName="FileResultsStatus")}catch{}try{$.displayName||($.displayName="FileResultRow")}catch{}try{H.displayName||(H.displayName="DirectoryIcon")}catch{}try{O.displayName||(O.displayName="FileResultIcon")}catch{}try{G.displayName||(G.displayName="MemoizedFileResultRow")}catch{}try{q.displayName||(q.displayName="HighlightMatch")}catch{}},21573:(e,r,t)=>{t.d(r,{$:()=>h,f:()=>f});var a=t(85893),n=t(46263),s=t(47357),i=t(23180),l=t(71207),o=t(85529),c=t(51526),u=t(42483),d=t(67294);let f=d.forwardRef(({ariaActiveDescendant:e,ariaControls:r,ariaExpanded:t,ariaHasPopup:l,onBlur:f,onFocus:m,onKeyDown:x,onPreload:p,onSearch:g,query:v,sx:w={}},y)=>{let{sendRepoClickEvent:b}=(0,i.a)(),[C,j]=d.useState(v),R=d.useRef((0,n.D)(e=>g(e),250));d.useEffect(()=>{j(v)},[v]);let E=v?(0,a.jsx)(c.Z.Action,{onClick:()=>{b("FILE_TREE.CANCEL_SEARCH"),g("")},icon:o.XCircleFillIcon,"aria-label":"Clear",sx:{color:"fg.subtle"}}):void 0;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{autoFocus:h(),ref:y,value:C,onKeyDown:x,onChange:e=>{j(e.target.value),p(),R.current(e.target.value)},sx:{display:"flex",...w},"aria-label":"Go to file","aria-activedescendant":e,role:l?"combobox":void 0,"aria-controls":r,"aria-expanded":t,"aria-haspopup":l?"dialog":void 0,autoCorrect:"off",spellCheck:"false",placeholder:"Go to file",leadingVisual:o.SearchIcon,trailingAction:E,trailingVisual:E?void 0:()=>(0,a.jsx)(s.I,{children:(0,a.jsx)(u.Z,{sx:{mr:"-6px"},children:(0,a.jsx)("kbd",{children:"t"})})}),onFocus:e=>{p(),e.target.select(),m?.(e)},onBlur:f,onClick:()=>b("FILE_TREE.SEARCH_BOX")})})});function h(){let e=new URLSearchParams(l.ssrSafeLocation.search);return"1"===e.get("search")}f.displayName="FilesSearchBox"}}]);
//# sourceMappingURL=ui_packages_code-view-shared_components_files-search_FileResultsList_tsx-8a060204c58c.js.map